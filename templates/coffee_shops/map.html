{% extends 'base.html' %}
{% load static %}

{% block title %}Coffee Shop Map - Dublin Coffee Finder{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/map.css' %}">
{% endblock %}

{% block content %}
<div class="wrapper">
    <!-- Left Sidebar - Search Controls -->
    <div class="sidebar">
        <h5 class="mb-3"><i class="fas fa-search"></i> Search Coffee Shops</h5>
        
        <!-- Mode Selector -->
        <div class="mode-selector control-group">
            <label class="form-label"><strong>Select Search Mode:</strong></label>
            <select id="search-mode" class="form-select mb-3">
                <option value="nearest">Find Nearest Shops</option>
                <option value="radius">Search by Radius</option>
                <option value="distance">Distance Between Shops</option>
            </select>
        </div>

        <!-- Nearest Search Settings -->
        <div id="nearest-settings" class="search-settings control-group">
            <label class="form-label">Number of nearest shops:</label>
            <select id="limit-select" class="form-select mb-3">
                <option value="3">3 nearest</option>
                <option value="5" selected>5 nearest</option>
                <option value="10">10 nearest</option>
            </select>
            <div class="alert alert-info py-2 small">
                <i class="fas fa-info-circle"></i> Click anywhere on the map to find nearest coffee shops
            </div>
        </div>

        <!-- Radius Search Settings -->
        <div id="radius-settings" class="search-settings control-group" style="display: none;">
            <label class="form-label">Search radius (km):</label>
            <input type="number" id="radius-km" class="form-control mb-3" 
                   value="2" min="0.5" max="20" step="0.5">
            <div class="alert alert-info py-2 small">
                <i class="fas fa-info-circle"></i> Click on the map to search within the radius
            </div>
        </div>

        <!-- Distance Calculation Settings -->
        <div id="distance-settings" class="search-settings control-group" style="display: none;">
            <div class="alert alert-warning py-2 small mb-3">
                <i class="fas fa-info-circle"></i> Click on TWO coffee shop markers to measure distance between them
            </div>
            <div id="distance-result" class="alert alert-success" style="display: none;">
                <strong>Distance:</strong>
                <div id="distance-text"></div>
            </div>
        </div>

        <!-- Clear Button -->
        <button id="clear-btn" class="btn btn-outline-secondary w-100 mt-3">
            <i class="fas fa-times"></i> Clear Results
        </button>
    </div>

    <!-- Map Container -->
    <div class="map-container">
        <div id="map"></div>
        
        <!-- Results Panel (floating on map) -->
        <div class="results-panel" id="results-panel">
            <div class="card border-0">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0"><i class="fas fa-list"></i> <span id="results-title">Results</span></h6>
                    <button id="close-results" class="btn-close btn-close-white"></button>
                </div>
                <div id="results-content" class="card-body p-0"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/map-config.js' %}"></script>
<script src="{% static 'js/map-markers.js' %}"></script>
<script src="{% static 'js/search-handlers.js' %}"></script>
<script src="{% static 'js/map-init.js' %}"></script>
{% endblock %}